<-- Martin Balbin  -->
<!DOCTYPE html>

<html>

<head>
    <style>
        body {
            /*El margen en 0 y el desbordamiento en oculto, para la pantalla completa*/
            margin: 0;
            overflow: hidden;
            background-color: #000000;
        }
    </style>

    <title>Parcial Segundo corte</title>

    <script type="text/javascript" src="../libs/three.js"></script>
    <script type="text/javascript" src="../libs/stats.js"></script>
    <script type="text/javascript" src="../libs/physi.js"></script>
    <script type="text/javascript" src="../libs/dat.gui.js"></script>
    <script type="text/javascript" src="../libs/chroma.js"></script>
    <script type="text/javascript">
    Physijs.scripts.worker = '../libs/physijs_worker.js';
    Physijs.scripts.ammo = '../libs/ammo.js';

    var initScene, render, ground_material, box_material,
                projector, renderer, render_stats, physics_stats, scene, ground, light, camera, box;

        initScene = function () {
            projector = new THREE.Projector;

            renderer = new THREE.WebGLRenderer({antialias: true});
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(new THREE.Color(0x00ffff));
            renderer.shadowMapEnabled = true;


            document.getElementById('viewport').appendChild(renderer.domElement);

            render_stats = new Stats();
            render_stats.domElement.style.position = 'absolute';
            render_stats.domElement.style.top = '1px';
            render_stats.domElement.style.right = '1px';
            render_stats.domElement.style.zIndex = 100;
            document.getElementById('viewport').appendChild(render_stats.domElement);

//Crear Scena
            scene = new Physijs.Scene({reportSize: 10, fixedTimeStep: 1 / 60});

            scene.setGravity(new THREE.Vector3(0, -10, 0));
//Crear camara
            camera = new THREE.PerspectiveCamera(
                    35,
                    window.innerWidth / window.innerHeight,
                    1,
                    1000
            );
            camera.position.set(40, 80, 65);
            camera.lookAt(new THREE.Vector3(0, 0, 0));
            scene.add(camera);

 // Light
            light = new THREE.SpotLight(0xFFFFFF);
            light.position.set(20, 50, 50);
            light.castShadow = true;
            light.shadowMapDebug = true;
            light.shadowCameraNear = 10;
            light.shadowCameraFar = 100;


            scene.add(light);
// Iniciamos el plano
createGround();

//Definimos las variables que van a controlador los movimientos
            var sliderBottomConstraint = createSliderBottom();
            var sliderTopConstraint = createSliderTop();
            
//Definimos la esfera
            var point2point = createPointToPoint(true);

//Crear controles
            var controls = new function () {
                this.enableMotor = false;
                this.acceleration = 10;
                this.velocity = -20;

                this.Movimiento = function () {
                 
                };

                this.sliderLeft = function () {
                    sliderBottomConstraint.disableLinearMotor();
                    sliderBottomConstraint.enableLinearMotor(controls.velocity, controls.acceleration);
                  };

                this.sliderRight = function () {
                    sliderBottomConstraint.disableLinearMotor();
                    sliderBottomConstraint.enableLinearMotor(-1 * controls.velocity, controls.acceleration);
               
                };
            };
//Crear controles de movimiento 

            controls.Movimiento();

            var gui = new dat.GUI();
            gui.domElement.style.position = 'absolute';
            gui.domElement.style.top = '20px';
            gui.domElement.style.left = '20px';

            var sliderFolder = gui.addFolder('sliders');
            sliderFolder.add(controls, "sliderLeft").onChange(controls.sliderLeft);
            sliderFolder.add(controls, "sliderRight").onChange(controls.sliderRight);

            requestAnimationFrame(render);
            scene.simulate();
        };
        
//Crear plano 
        function createGround() {
 // Materiales
            ground_material = Physijs.createMaterial(
                    new THREE.MeshPhongMaterial(
                            {
                             map: THREE.ImageUtils.loadTexture('../assets/floor-wood.jpg')
                            })
                            );
// suelo o ground
            ground = new Physijs.BoxMesh(
                    new THREE.BoxGeometry(60, 1, 65),
                    ground_material,
                    0 // mass
            );
            ground.receiveShadow = true;
            var borderTop = new Physijs.BoxMesh(
                    new THREE.BoxGeometry(64, 6, 2),
                    ground_material,
                    0 // mass
            );

            ground.receiveShadow = true;
            scene.add(ground);
        }

      
//Creamos el objeto esfera

            function createPointToPoint() {
            var esfera = new THREE.SphereGeometry(2);
            var objectOne = new Physijs.SphereMesh(esfera, Physijs.createMaterial(
                    new THREE.MeshPhongMaterial({color: 0xffff00})
                    ));
            //Posicion inicial de la esfera
            objectOne.position.z = -18;
            objectOne.position.x = -1;
            objectOne.position.y = 2;
            objectOne.castShadow = true;
            scene.add(objectOne);


            var constraint = new Physijs.PointConstraint(objectOne, objectOne.position);
            scene.addConstraint(constraint);
        }

        function createSliderBottom() {
            var BarraJugador = new THREE.BoxGeometry(12, 2, 2);


            var sliderMesh = new Physijs.BoxMesh(BarraJugador, Physijs.createMaterial(
                    new THREE.MeshPhongMaterial({color: 0x44ff44, opacity: 0.6, transparent: true}), 0, 0), 0.01);
            sliderMesh.position.z = 20;
            sliderMesh.position.x = 6;
            sliderMesh.position.y = 1.5;
            sliderMesh.castShadow = true;


            scene.add(sliderMesh);
            var constraint = new Physijs.SliderConstraint(sliderMesh, new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 1, 0));

            //Colocamos los limites que debe llevar nuestra barra jugadora
            scene.addConstraint(constraint);
            constraint.setLimits(-20, 10, 0, 0);
            
            return constraint;
        }

        function createSliderTop() {
            var BarraMaquina = new THREE.BoxGeometry(12, 2, 2);


            var sliderMesh = new Physijs.BoxMesh(BarraMaquina, Physijs.createMaterial(
                    new THREE.MeshPhongMaterial({color: 0x44ff44, opacity: 0.6, transparent: true}), 0, 0), 0.01);
            sliderMesh.position.z = -25;
            sliderMesh.position.x = 6;
            sliderMesh.position.y = 1.5;
            scene.add(sliderMesh);
            sliderMesh.castShadow = true;

            //position is the position of the axis, relative to the ref, based on the current position
            var constraint = new Physijs.SliderConstraint(sliderMesh, new THREE.Vector3(-10, 0, 20), new THREE.Vector3(Math.PI / 2, 0, 0));

            scene.addConstraint(constraint);
            constraint.setLimits(-20, 10, 0.5, -0, 5);
            constraint.setRestitution(0.2, 0.1);

            return constraint;
        }

        var direction = -2;

        
        render = function () {
            requestAnimationFrame(render);
            renderer.render(scene, camera);
            render_stats.update();
            ground.__dirtyRotation = true;
            scene.simulate(undefined, 2);
        };


        window.onload = initScene;

    </script>
</head>

<body>
<div id="viewport"></div>
</body>

</html>